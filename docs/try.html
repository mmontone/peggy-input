<html>
  <head>
    <style>
      .grid-container {
          display: grid;
          grid-template-columns: auto auto;
      }
    </style>
  </head>
  <body>
    <label>Test input: </label><input id="input" type="text" style="width: 400px;"></input>

    <div class="grid-container">
      <div class="grid-item">
        <h4>Grammar</h4>
        <textarea id="grammar" style="width: 500px; height:500px;">
start = assignment
assignmentgroup = "everyone" / groupmembers
assignment = g:assignmentgroup " " "but " as:assignees { return [g, {'not': as}] } / assignees
assignee = "everyone" / user / groupmembers
assignees = a:assignee WS "," WS as:assignees { return [a].concat(as) } / a:assignee { return [a] }
groupmembers = "members of " groups:groups { return {'membersOf':groups} }
groups = g:group WS "," WS gs:groups { return [g].concat(gs) } / g:group { return [g] }
spacedgroupname = w1:word " " w2:word { return w1 + " " + w2 }
group "group" =  group:spacedgroupname @{ group } / group:word @{ group }
user = "@" username:username { return {'user':username} }
username "username" = username:name @{ username } { return username }
WS = [ \t]*
word = $[a-z]i+
name = word:word " " name:name { return word + " " + name } / word
        </textarea>
      </div>
      <div class="grid-item">
        <div>
          <h4>Result</h4>
          <textarea id="result" style="width: 400px; height: 200px;">
          </textarea>
          <div id="error" style="color:red;"></div>
        </div>
        <div>
          <h4>Initialize</h4>
          <textarea id="initialize" style="width: 500px; height: 200px;">
            var users = ['Mariano Montone', 'Asgeir Bjorlykke', 'Martin Montone'];
            var groups = ['Management', 'Administration', 'Human Resources'];
            ({
              'completers': {
                  'username' : users,
                  'group' : groups
              }
            })
          </textarea>
        </div>
        <div><button id="apply" class="btn">Apply</button></div>
      </div>
    </div>
    <script src="peggy-input.js"></script>
    <script type="text/javascript">
      $('#apply').click(function () {
          $('#input').replaceWith('<input id="input" type="text" style="width: 400px;"></input>');
          try {
              $('#error').text('');
              let options = eval($('#initialize').val());
              options.grammar = $('#grammar').val();
              window.peggyInput = PeggyInput('#input', options);
              window.peggyInput.resultHandler = function (result) {
                  $('#result').html(JSON.stringify(result));
              };
          }
          catch (e) {
              $('#error').text(e.message);
          }
      });
    </script>
  </body>
</html>
